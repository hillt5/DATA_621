---
title: "Data 621 - HW5"
author: "Devin Teran, Atina Karim, Tom Hill, Amit Kapoor"
date: "5/23/2021"
output:
  pdf_document:
    toc: TRUE
    toc_depth: 2 
  html_document:
    highlight: pygments
    number_sections: no
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, error=FALSE, warning=FALSE, message=FALSE, fig.align = "center")
```


```{r loadData, include=FALSE}
# Libraries


library(DataExplorer)
library(visdat)
library(dplyr)
library(tidyr)
library(MASS)

        
set.seed(621)
```


```{r data}
# training data
wine_train <- read.csv('https://raw.githubusercontent.com/hillt5/DATA_621/master/HW5/wine-training-data.csv') %>% select(-'Ã¯..INDEX')
# test data
wine_test <- read.csv('https://raw.githubusercontent.com/hillt5/DATA_621/master/HW5/wine-evaluation-data.csv') %>% select(-'IN')
```



# Overview

In this assignment, we will explore, analyze and model a data set containing information on approximately 12,000 commercially available wines. The variables are mostly related to the chemical properties of the wine being sold. The response variable is the number of sample cases of wine that were purchased by wine distribution companies after sampling a wine. These cases would be used to provide tasting samples to restaurants and wine stores around the United States. The more sample cases purchased, the more likely is a wine to be sold at a high end restaurant. A large wine manufacturer is studying the data in order to predict the number of wine cases ordered based upon the wine characteristics. If the wine manufacturer can predict the number of cases, then that manufacturer will be able to adjust their wine offering to maximize sales. 

The objective is to build a count regression model to predict the number of cases of wine that will be sold given certain properties of the wine.


# Data Exploration

Below is the description of the variables of interest in the data set.

|VARIABLE NAME|DEFINITION|THEORETICAL EFFECT|
|--|----|---|
|TARGET|Number of Cases Purchased|None|
|AcidIndex|Proprietary method of testing total acidity of wine by using a weighted average||
|Alcohol|Alcohol Content||
|Chlorides|Chloride content of wine||
|CitricAcid|Citric Acid Content||
|Density|Density of Wine||
|FixedAcidity|Fixed Acidity of Wine||
|FreeSulfurDioxide|Sulfur Dioxide content of wine||
|LabelAppeal|Marketing Score indicating the appeal of label design for consumers. High numbers suggest customers like the label design. Negative numbers suggest customers don't like the design.|Many consumers purchase based on the visual appeal of the wine label design. Higher numbers suggest better sales.|
|ResidualSugar|Residual Sugar of wine||
|STARS|Wine rating by a team of experts. 4 Stars = Excellent, 1 Star = Poor|A high number of stars suggests high sales|
|Sulphates|Sulfate content of wine||
|TotalSulfurDioxide|Total Sulfur Dioxide of Wine||
|VolatileAcidity|Volatile Acid content of wine||
|pH|pH of wine||


## Numeric Variables


```{r, histograms}
plot_histogram(wine_train, geom_histogram_args = list("fill" = "tomato4"))

```



```{r, distinct-values}
tibble(wine_train %>% summarize_all(n_distinct))
```


All variables in this dataset are initially interpretable as numeric data. There are several variables, including AcidIndex, LabelAppeal, and STARS that have few distinct values and may be treated as factors in the future. The target variable, number of cases, also only spans values 0 - 8.  


### Missing Values


```{r, missing-values}


colSums(is.na(wine_train))


vis_dat(wine_train  %>% dplyr:: select(pH, ResidualSugar, Chlorides, Alcohol, FreeSulfurDioxide , TotalSulfurDioxide, Sulphates, STARS))


```

The feature with the most misisng variables is STARS, which is a rating between 1-4. It's plausible that the misising values in this case are wine brands that are unrated by STARS.  These missing values can potentially be recoded as 'zero' to avoid dropping a substantial proportion of data.   There also does not appear to be any apparent pattern in misisng data.  



````{r, pct-missing-values}

plot_missing(wine_train)


100*round((wine_train %>% drop_na() %>% nrow())/nrow(wine_train), 3) ##Number of observations with complete data for each variable

```

The remaining missing values comprise less than ten percent of observations separately. Taken together, just over 50% of observations have complete data available.  


# Data Preparation

```{r, STARS-missing-values}


wine_train <- wine_train %>%
  mutate(STARS = replace_na(STARS, 0))  ## Recode missing STARS ratings as '0'



```


```{r, impute-median}


wine_impute <- mlr:: impute(wine_train, classes = list(numeric = mlr::imputeMedian()))


```
# Build Models

### Linear Model
```{r, first-model}

summary(lm(wine_train, formula = TARGET ~.))

```

### Poisson Regression for Zero-inflated Count as Response Variable

```{r, poisson-model}

summary(glm(wine_train, formula = TARGET ~., family = poisson ))


```


```{r, negative-binom-model}

summary(glm.nb(wine_train, formula = TARGET ~. ))

```

# Select Models


# Code Appendix

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```

















